<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('../partials/head'); %>
</head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.3.4/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<body class="container-fluid">

  <div class="header-nav">
    <div class="container-fluid">
      <header>
        <%- include('partials_provider/header'); %>
      </header>
    </div>
  </div>

  <div class="bigDiv" id="bigDiv">
    <form @submit.prevent="createPost">
      <div class="container-fluid">
        <div class="makeAuctionTemplate">
          <h3>Fill out this form to submit an auction</h3>
        </div>
      </div>

      <div class="container-fluid" id="gameRules">
        <div class="makeAuctionTemplate">
          <h5>Use this form to define an auction game</h5>
          <div class="form-group" id="auctionType">
            <label for="chooseBiddingType">Choose Bidding Type</label>
            <div class="row">
              <div class="col-10">
                <select class="form-control" id="chooseBidType" v-model="formData.auctionType" v-on:change="changePricing">
                  <option name="english" value="english">English Auction</option>
                  <option name="dutch" value="dutch">Dutch Auction</option>
                  <option name="fpsb" value="fpsb">First Priced Sealed Bid Auction</option>
                  <option name="spsb" value="spsb">Second Priced Sealed Bid Auction</option>
                </select>
              </div>
            </div>
          </div>
          <div v-if="formData.auctionType === 'english'">
            <div class="auctionRules" style="margin-left:10px">
              <h5>English Auction</h5>
              <div class="form-group">
                <label for="pricing">Reserve Price</label>
                <div class="row">
                  <div class="col-10">
                    <div class="input-group">
                      <input type="number" class="form-control" v-model="formData.pricing.pricingReserve">
                      <div class="input-group-append">
                        <select class="form-control" v-model="formData.pricing.pricingSubscription">
                          <option name="flatFee" value="flatFee">Flat Fee</option>
                          <option name="perHour" value="perHour">Per Hour</option>
                          <option name="perMonth" value="perMonth">Per Month</option>
                          <option name="perYear" value="perYear">Per Year</option>
                        </select>
                      </div>
                      <div class="input-group-append">
                        <select class="form-control" v-model="formData.pricing.pricingCurrency">
                          <option name="euro" value="euro">€</option>
                          <option name="yuan" value="yuan">元</option>
                          <option name="kuna" value="kuna">Kuna</option>
                          <option name="dollar" value="dollar">$</option>
                          <option name="btc" value="btc">฿</option>
                          <option name="eth" value="eth">ETH</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <!--<div class="row" style="margin-top:10px">
                  <div class="col-10">
                    <div class="form-check" autocomplete="off">
                      <label class="form-check-label" for="exampleCheck1">Hide Reserve price</label>
                      <input type="checkbox" class="form-check-input" id="check1" v-model="formData.hideReserve" style="margin-left: 10px;">
                    </div>
                  </div>
                </div>-->
              </div>
              <div class="form-group">
                <label for="pricing">Starting Price</label>
                <div class="row">
                  <div class="col-10">
                    <div class="input-group">
                      <input type="number" class="form-control" v-model="formData.pricing.startPrice">
                      <div class="input-group-append">
                        <select class="form-control" v-model="formData.pricing.pricingSubscription">
                          <option name="flatFee" value="flatFee">Flat Fee</option>
                          <option name="perHour" value="perHour">Per Hour</option>
                          <option name="perMonth" value="perMonth">Per Month</option>
                          <option name="perYear" value="perYear">Per Year</option>
                        </select>
                      </div>
                      <div class="input-group-append">
                        <select class="form-control" v-model="formData.pricing.pricingCurrency">
                          <option name="euro" value="euro">€</option>
                          <option name="yuan" value="yuan">元</option>
                          <option name="kuna" value="kuna">Kuna</option>
                          <option name="dollar" value="dollar">$</option>
                          <option name="btc" value="btc">฿</option>
                          <option name="eth" value="eth">ETH</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="pricing">Bidding step</label>
                <div class="row">
                  <div class="col-10">
                    <div class="input-group">
                      <input type="number" class="form-control" v-model="formData.pricing.biddingStep">
                      <div class="input-group-append">
                        <select class="form-control" v-model="formData.pricing.pricingSubscription">
                          <option name="flatFee" value="flatFee">Flat Fee</option>
                          <option name="perHour" value="perHour">Per Hour</option>
                          <option name="perMonth" value="perMonth">Per Month</option>
                          <option name="perYear" value="perYear">Per Year</option>
                        </select>
                      </div>
                      <div class="input-group-append">
                        <select class="form-control" v-model="formData.pricing.pricingCurrency">
                          <option name="euro" value="euro">€</option>
                          <option name="yuan" value="yuan">元</option>
                          <option name="kuna" value="kuna">Kuna</option>
                          <option name="dollar" value="dollar">$</option>
                          <option name="btc" value="btc">฿</option>
                          <option name="eth" value="eth">ETH</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div v-else-if="formData.auctionType === 'dutch'">
            <div class="auctionRules" style="margin-left:10px">
              <h5>Dutch Auction</h5>
              <div class="form-group">
                <label for="pricing">Reserve Price</label>
                <div class="row">
                  <div class="col-10">
                    <div class="input-group">
                      <input type="number" class="form-control" v-model="formData.pricing.pricingReserve">
                      <div class="input-group-append">
                        <select class="form-control" v-model="formData.pricing.pricingSubscription">
                          <option name="flatFee" value="flatFee">Flat Fee</option>
                          <option name="perHour" value="perHour">Per Hour</option>
                          <option name="perMonth" value="perMonth">Per Month</option>
                          <option name="perYear" value="perYear">Per Year</option>
                        </select>
                      </div>
                      <div class="input-group-append">
                        <select class="form-control" v-model="formData.pricing.pricingCurrency">
                          <option name="euro" value="euro">€</option>
                          <option name="yuan" value="yuan">元</option>
                          <option name="kuna" value="kuna">Kuna</option>
                          <option name="dollar" value="dollar">$</option>
                          <option name="btc" value="btc">฿</option>
                          <option name="eth" value="eth">ETH</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <!--<div class="row" style="margin-top:10px">
                  <div class="col-10">
                    <div class="form-check" autocomplete="off">
                      <label class="form-check-label" for="exampleCheck1">Hide Reserve price</label>
                      <input type="checkbox" class="form-check-input" id="check1" v-model="formData.hideReserve" style="margin-left: 10px;">
                    </div>
                  </div>
                </div>-->
              </div>
              <div class="form-group">
                <label for="pricing">Starting Price</label>
                <div class="row">
                  <div class="col-10">
                    <div class="input-group">
                      <input type="number" class="form-control" v-model="formData.pricing.startPrice">
                      <div class="input-group-append">
                        <select class="form-control" v-model="formData.pricing.pricingSubscription">
                          <option name="flatFee" value="flatFee">Flat Fee</option>
                          <option name="perHour" value="perHour">Per Hour</option>
                          <option name="perMonth" value="perMonth">Per Month</option>
                          <option name="perYear" value="perYear">Per Year</option>
                        </select>
                      </div>
                      <div class="input-group-append">
                        <select class="form-control" v-model="formData.pricing.pricingCurrency">
                          <option name="euro" value="euro">€</option>
                          <option name="yuan" value="yuan">元</option>
                          <option name="kuna" value="kuna">Kuna</option>
                          <option name="dollar" value="dollar">$</option>
                          <option name="btc" value="btc">฿</option>
                          <option name="eth" value="eth">ETH</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="pricing">Bidding step</label>
                <div class="row">
                  <div class="col-10">
                    <div class="input-group">
                      <input type="number" class="form-control" v-model="formData.pricing.biddingStep">
                      <div class="input-group-append">
                        <select class="form-control" v-model="formData.pricing.pricingSubscription">
                          <option name="flatFee" value="flatFee">Flat Fee</option>
                          <option name="perHour" value="perHour">Per Hour</option>
                          <option name="perMonth" value="perMonth">Per Month</option>
                          <option name="perYear" value="perYear">Per Year</option>
                        </select>
                      </div>
                      <div class="input-group-append">
                        <select class="form-control" v-model="formData.pricing.pricingCurrency">
                          <option name="euro" value="euro">€</option>
                          <option name="yuan" value="yuan">元</option>
                          <option name="kuna" value="kuna">Kuna</option>
                          <option name="dollar" value="dollar">$</option>
                          <option name="btc" value="btc">฿</option>
                          <option name="eth" value="eth">ETH</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div v-else-if="formData.auctionType === 'fpsb'">
            <div class="auctionRules" style="margin-left:10px">
              <h5>First Priced Sealed Bid Auction</h5>
              <div class="form-group">
                <label for="pricing">Reserve Price</label>
                <div class="row">
                  <div class="col-10">
                    <div class="input-group">
                      <input type="number" class="form-control" v-model="formData.pricing.pricingReserve">
                      <div class="input-group-append">
                        <select class="form-control" v-model="formData.pricing.pricingSubscription">
                          <option name="flatFee" value="flatFee">Flat Fee</option>
                          <option name="perHour" value="perHour">Per Hour</option>
                          <option name="perMonth" value="perMonth">Per Month</option>
                          <option name="perYear" value="perYear">Per Year</option>
                        </select>
                      </div>
                      <div class="input-group-append">
                        <select class="form-control" v-model="formData.pricing.pricingCurrency">
                          <option name="euro" value="euro">€</option>
                          <option name="yuan" value="yuan">元</option>
                          <option name="kuna" value="kuna">Kuna</option>
                          <option name="dollar" value="dollar">$</option>
                          <option name="btc" value="btc">฿</option>
                          <option name="eth" value="eth">ETH</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <!--<div class="row" style="margin-top:10px">
                  <div class="col-10">
                    <div class="form-check" autocomplete="off">
                      <label class="form-check-label" for="exampleCheck1">Hide Reserve price</label>
                      <input type="checkbox" class="form-check-input" id="check1" v-model="formData.hideReserve" style="margin-left: 10px;">
                    </div>
                  </div>
                </div>-->
              </div>
            </div>
          </div>
          <div v-else="formData.auctionType === 'spsb'">
            <div class="auctionRules" style="margin-left:10px">
              <h5>Second Priced Sealed Bid Auction</h5>
              <div class="form-group">
                <label for="pricing">Reserve Price</label>
                <div class="row">
                  <div class="col-10">
                    <div class="input-group">
                      <input type="number" class="form-control" v-model="formData.pricing.pricingReserve">
                      <div class="input-group-append">
                        <select class="form-control" v-model="formData.pricing.pricingSubscription">
                          <option name="flatFee" value="flatFee">Flat Fee</option>
                          <option name="perHour" value="perHour">Per Hour</option>
                          <option name="perMonth" value="perMonth">Per Month</option>
                          <option name="perYear" value="perYear">Per Year</option>
                        </select>
                      </div>
                      <div class="input-group-append">
                        <select class="form-control" v-model="formData.pricing.pricingCurrency">
                          <option name="euro" value="euro">€</option>
                          <option name="yuan" value="yuan">元</option>
                          <option name="kuna" value="kuna">Kuna</option>
                          <option name="dollar" value="dollar">$</option>
                          <option name="btc" value="btc">฿</option>
                          <option name="eth" value="eth">ETH</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <!--<div class="row" style="margin-top:10px">
                  <div class="col-10">
                    <div class="form-check" autocomplete="off">
                      <label class="form-check-label" for="exampleCheck1">Hide Reserve price</label>
                      <input type="checkbox" class="form-check-input" id="check1" v-model="formData.hideReserve" style="margin-left: 10px;">
                    </div>
                  </div>
                </div>-->
              </div>
            </div>
          </div>
          <input id="initializer" name="initializer" type="hidden" value="provider">
        </div>
      </div>

      <h3 style="margin-top:10px;color:green;text-align:center;">
        AWESOME Auction
      </h3>
      <hr style="color:green; border: 2px solid">
      <div id="allBids">
        <div class="container-fluid" id="fullBid">
          <div class="makeAuctionTemplate">
            <h4>Service 1</h4>
            <div class="commodity" id="commodity">
              <div class="container-fluid">
                <h5>Use this form to define a commodity</h5>
                <div class="form-group" id="docTypeForm">
                  <label for="docType">Define commodity type</label>
                  <div class="row">
                    <div class="col-6">
                      <input type="text" class="form-control" v-model="formData.service.docType" id="docType" placeholder="e.g. vmInstance, blobStorage etc.">
                    </div>
                  </div>
                </div>
                <div class="form-group" id="commoditySpecs">
                  <label for="commoditySpecs">Add commodity property types and values</label>
                  <div class="row">
                    <div class="col-lg-12" style="margin-bottom: 10px">
                      <button id="addRow1" type="button" class="btn btn-info" v-on:click="addNewProperty">Add property</button>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-lg-12">
                      <div v-for="(property, index2) in formData.service.properties">
                        <div class="input-group mb-3">
                          <div class="form-row">
                            <div class="input-group-append">
                              <div class="col">
                                <input type="text" v-model="property.commodityKey" class="form-control" placeholder="e.g. Storage capacity">
                              </div>
                              <div class="col">
                                <input type="text" v-model="property.commodityValue" class="form-control" placeholder="e.g. 60GiB">
                              </div>
                            </div>
                            <div class="input-group-append">
                              <button id="removeRow1" type="button" class="btn btn-danger" v-on:click="removeProperty(index2)">Remove</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="slaForm" id="slaForm">
              <div class="container-fluid">
                <h5>Use this form to define the SLA rules and violation penalties</h5>
                <div class="form-group" id="SLArules">
                  <label for="SLArules">Add SLA rules and penalties</label>
                  <div class="row">
                    <div class="col-lg-12" style="margin-bottom: 10px">
                      <button id="addRow2" type="button" class="btn btn-info" v-on:click="addNewRule">Add Rule</button>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-lg-12">
                      <div v-for="(rule, index2) in formData.service.rules">
                        <div class="input-group mb-3">
                          <div class="input-group-append">
                            <div class="col">
                              <input type="text" v-model="rule.ruleString" class="form-control" placeholder="Enter rule: eg. Server down" autocomplete="off">
                            </div>
                            <div class="col">
                              <div class="input-group-append">
                                <input type="number" v-model="rule.ruleFine" class="form-control" placeholder="Fine amount"></div>
                            </div>
                            <div class="input-group-append">
                              <select class="form-control" id="rules" v-model="rule.currency">
                                <option name="euro" value="euro">€</option>
                                <option name="yuan" value="yuan">元</option>
                                <option name="kuna" value="kuna">Kuna</option>
                                <option name="dollar" value="dollar">$</option>
                                <option name="pound" value="pound">£</option>
                                <option name="btc" value="btc">฿</option>
                                <option name="eth" value="eth">ETH</option>
                              </select>
                            </div>
                            <div class="input-group-append">
                              <button id="removeRow2" type="button" class="btn btn-danger" v-on:click="removeRule(index2)" style="margin-left: 10px">Remove</button>
                            </div>
                          </div>
                          <div class="input-group-append">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <hr style="color:green; border: 2px solid">
      <div class="makeAuctionTemplate">
        {{formData}}
      </div>
      <div class="container-fluid">
        <div class="makeAuctionTemplate">
          <button name="submit" type="submit" class="btn btn-outline-dark">Submit Auction</button>
        </div>
      </div>
    </form>
  </div>

  <footer>
    <%- include('../partials/footer'); %>
  </footer>

  <script type="text/javascript">
    window.app = new Vue({
      el: '#bigDiv',
      data() {
        return {
          formData: {
            auctionType: 'english',
            auctionDirection: 'forward',
            pricing: {
              startPrice: '',
              pricingReserve: '',
              biddingStep: '',
              pricingSubscription: 'flatFee',
              pricingCurrency: 'euro'
            },
            service: {
              docType: '',
              rules: [],
              properties: []
            }
          }
        }
      },
      methods: {
        changePricing: function() {
          if (this.formData.auctionType == 'english') {
            var pricing = {
              startPrice: '',
              pricingReserve: '',
              biddingStep: '',
              pricingSubscription: 'flatFee',
              pricingCurrency: 'euro'
            }
            this.formData.pricing = pricing;
          } else if (this.formData.auctionType == 'dutch') {
            var pricing = {
              startPrice: '',
              pricingReserve: '',
              biddingStep: '',
              pricingSubscription: 'flatFee',
              pricingCurrency: 'euro'
            }
            this.formData.pricing = pricing;
          } else if (this.formData.auctionType == 'fpsb') {
            var pricing = {
              pricingReserve: '',
              pricingSubscription: 'flatFee',
              pricingCurrency: 'euro'
            }
            this.formData.pricing = pricing;
          } else if (this.formData.auctionType == 'spsb') {
            var pricing = {
              pricingReserve: '',
              pricingSubscription: 'flatFee',
              pricingCurrency: 'euro'
            }
            this.formData.pricing = pricing;
          }
        },
        addNewProperty() {
          this.formData.service.properties.push({
            commodityKey: '',
            commodityValue: ''
          });
        },
        removeProperty: function(index2) {
          this.formData.service.properties.splice(index2, 1);
        },
        addNewRule(index) {
          this.formData.service.rules.push({
            ruleString: '',
            ruleFine: '',
            currency: 'euro'
          })
        },
        removeRule: function(index2) {
          this.formData.service.rules.splice(index2, 1);
        },
        createPost() {
          axios.post('/ui_provider/postFullAuction', this.formData)
            .then(function(response) {
              if (response.data.redirect == '/ui_provider/postAuctionThankYou') {
                window.location = "/ui_provider/postAuctionThankYou"
              } else if (response.data.redirect == '/ui_provider/postAuctionThankYou') {
                window.location = "/ui_provider/postAuctionThankYou"
              }
              //a catch or something was here
            })
            .catch(function(error) {
              window.location = "/ui_provider/postAuctionThankYou"
            })
        }
      }
    });
  </script>
</body>

</html>

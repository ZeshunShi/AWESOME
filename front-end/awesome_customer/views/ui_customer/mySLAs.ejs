<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('../partials/head'); %>
</head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.3.4/vue.js"></script>
<script src="https://unpkg.com/vue-router"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<body>

  <header>
    <%- include('partials_customer/header'); %>
  </header>

  <main id=main>
    <div class="container-fluid">
      <h3 style="margin-top:10px;color:green;text-align:center;">
        AWESOME SLAs: {{owner}}
      </h3>
      <hr style="color:green; border: 2px solid">
      <div class="container">
        <div class="row">
          <div v-for="sla in slaArr" class="col-md-6 col-12 my-2">
            <div class="card border-success mb-3">
              <div class="card-header">
                <h5 style="margin-top:10px;color:green;text-align:center;">
                  {{sla.key}}
                </h5>
              </div>
              <div class="card-body">
                <h5 class="card-title" style="color:green;">{{sla.info.docType}}</h5>
                <h6 class="card-subtitle mb-2 text-muted" style="color:green;">Provider: {{sla.provider}}</h6>
                <h6 class="card-subtitle mb-2 text-muted" style="color:green;">Customer: {{sla.customer}}</h6>
                <h5 style="color: green;">Pricing</h5>
                <ul class="list-group list-group-flush" style="margin-top: 10px;">
                  <li class="list-group-item border-bottom"><b>Service fee: </b>{{sla.biggestBid.pricing.bidAmount}} {{getCurrency(sla.biggestBid.pricing.pricingCurrency)}}</li>
                  <li class="list-group-item border-bottom"><b>Subscription: </b>{{getSubscription(sla.biggestBid.pricing.pricingSubscription)}}</li>
                </ul>
                <br>
                <button type="button" class="btn btn-success btn-sm" v-on:click="showProperties(sla)">Service Properties</button>
                <div v-if="sla.showProperties">
                  <ul class="list-group list-group-flush" style="margin-top: 10px;">
                  <div v-for="property in sla.info.properties">
                      <li class="list-group-item list-group-item-success"><b>{{property.commodityKey}}: </b>{{property.commodityValue}}</li>
                  </div>
                  </ul>
                </div>
                <br>
                <button type="button" class="btn btn-success btn-sm" v-on:click="showSLA(sla)" style="margin-top:10px;">SLA rules</button>
                <div v-if="sla.showSLA">
                  <ul class="list-group list-group-flush" style="margin-top: 10px;">
                  <div v-for="rule in sla.info.rules">
                      <li class="list-group-item list-group-item-success"><b>{{rule.ruleString}}: </b>{{rule.ruleFine}} {{getCurrency(rule.currency)}}</li>
                  </div>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="container" v-for="sla in slaArr">
        <div class="makeAuctionTemplate">
          {{sla}}
          <a v-bind:href="'auctionCard?auctionID='+sla.key">{{sla.key}}</a>
        </div>
      </div>
  </main>

  <footer>
    <%- include('../partials/footer'); %>
  </footer>

  <script type="text/javascript">
    var router = new VueRouter({
      mode: 'history',
      routes: []
    });
    window.app = new Vue({
      router,
      el: '#main',
      data() {
        return {
          result: [],
          owner: 'customer1',
          slaArr: []
        }
      },
      methods: {
        parser(result) {
          for (var i = 0; i < result.length; i++) {
            r = result[i];
            key = r.Key;
            biggestBid = r.Record.biggestBid;
            customer = r.Record.customer;
            provider = r.Record.provider;
            info = r.Record.serviceInfo;
            this.slaArr.push({
              key,
              biggestBid,
              customer,
              provider,
              info,
              showProperties: false,
              showSLA: false
            });
          }
          /*this.auctionArr.push({
            key,
            auctionInfo,
            showProperties: false,
            showSLA: false,
            bids,
            highestBid,
            showHighestBid: true
          });*/

          //this.auction = JSON.parse(result.auction);
          //this.auctionSafe = JSON.parse(JSON.stringify(this.auction));
        },
        getSubscription(subscription) {
          if (subscription == "flatFee") {
            return "Flat fee";
          } else if (subscription == "perHour") {
            return "Per Hour";
          } else if (subscription == "perMonth") {
            return "Per Month";
          } else if (subscription == "perYear") {
            return "Per Year";
          } else {
            return "Flat Fee";
          }
        },
        showProperties(auc) {
          if (auc.showProperties == true) {
            auc.showProperties = false;
          } else {
            auc.showProperties = true;
          }
        },
        showSLA(auc) {
          if (auc.showSLA == true) {
            auc.showSLA = false;
          } else {
            auc.showSLA = true;
          }
        },
        getCurrency(currency) {
          if (currency == "euro") {
            return "€";
          } else if (currency == "yuan") {
            return "€";
          } else if (currency == "kuna") {
            return "Kuna";
          } else if (currency == "dollar") {
            return "$";
          } else if (currency == "btc") {
            return "฿";
          } else if (currency == "eth") {
            return "ETH";
          } else {
            return "€";
          }
        }
      },
      async created() {
        const res = await axios.get("/ui_customer/mySLAsInfo" + this.owner);
        this.result = res.data;
        console.log(this.result);
        this.parser(this.result);
      }
    });
  </script>

</body>

</html>
